<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Edit Battery Levels</title>
  <style>
    body { font-family: Arial, sans-serif; background: #222; color: #eee; margin: 2em; }
    h1 { margin-top: 1em; }
    h2 { margin-top: 2em; color: #eee; }
    .panel { background:#181818; border-radius:12px; padding:1.5em; min-width:420px; max-width:900px; margin-bottom:2em; }
    table { border-collapse: collapse; width: 100%; margin-bottom: 1em; background: #181818; color: #eee; }
    th, td { border: 1px solid #444; padding: 0.5em; text-align: center; }
    th { background: #222; color: #aaa; }
    input[type="number"], input[type="text"] { width: 6em; background: #222; color: #eee; border: 1px solid #444; border-radius: 4px; }
    input.hsv { width: 3em; min-width: 0; }
    .section { margin-bottom: 2em; }
    .save-btn { margin-top: 1em; background: #333; color: #eee; border: none; border-radius: 6px; padding: 0.7em 1.5em; font-size: 1em; cursor: pointer; }
    .save-btn:hover { background: #444; }
    #output { background:#181818; color:#eee; padding:1em; border:1px solid #444; border-radius:8px; }
  </style>
</head>
<body>
  <div class="panel">
    <div style="display:flex; gap:1em; margin-bottom:1em; align-items:center; justify-content:space-between;">
      <div>
        <button id="tab-charging" class="tab-btn" onclick="showTab('charging')">Charging</button>
        <button id="tab-discharging" class="tab-btn" onclick="showTab('discharging')">Discharging</button>
      </div>
      <button class="save-btn" onclick="saveJson()">Save JSON</button>
    </div>
    <div id="editor-charging" style="display:block;"></div>
    <div id="editor-discharging" style="display:none;"></div>
  </div>

  <script>
    let batteryData = null;
    const fields = ["min_voltage", "plugin", "h", "s", "v", "brightness"];

    function createTable(section, arr) {
      let html = `<div class='section'>`;
      html += `<table><tr>`;
      fields.forEach(f => html += `<th>${f}</th>`);
      html += `</tr>`;
      arr.forEach((row, idx) => {
        html += `<tr>`;
        fields.forEach(f => {
          let cls = (f === "h" || f === "s" || f === "v") ? "hsv" : "";
          html += `<td><input type='${f=="plugin"?"text":"number"}' class='${cls}' value='${row[f]}' data-section='${section}' data-idx='${idx}' data-field='${f}' onchange='updateField(this)' /></td>`;
        });
        html += `</tr>`;
      });
      html += `</table></div>`;
      return html;
    }

    function showTab(tab) {
      document.getElementById('editor-charging').style.display = tab === 'charging' ? 'block' : 'none';
      document.getElementById('editor-discharging').style.display = tab === 'discharging' ? 'block' : 'none';
      document.getElementById('tab-charging').style.background = tab === 'charging' ? '#333' : '#222';
      document.getElementById('tab-discharging').style.background = tab === 'discharging' ? '#333' : '#222';
    }

    function updateField(input) {
      const section = input.dataset.section;
      const idx = parseInt(input.dataset.idx);
      const field = input.dataset.field;
      let val = input.value;
      if (field !== "plugin") val = Number(val);
      batteryData[section][idx][field] = val;
      showJson();
    }

    function showJson() {
      // JSON preview removed, but keep batteryData in memory for future use
    }

    function saveJson() {
      const blob = new Blob([JSON.stringify(batteryData, null, 2)], {type: 'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'Battery_Levels.json';
      a.click();
      URL.revokeObjectURL(url);
    }

    // Load Battery_Levels.json
    fetch('Battery_Levels.json')
      .then(r => r.json())
      .then(json => {
        batteryData = json;
        document.getElementById('editor-charging').innerHTML = createTable('charging', batteryData.charging);
        document.getElementById('editor-discharging').innerHTML = createTable('discharging', batteryData.discharging);
        showTab('charging');
        showJson();
      })
      .catch(e => {
        document.getElementById('editor-charging').innerHTML = '<p style="color:red">Failed to load Battery_Levels.json</p>';
        document.getElementById('editor-discharging').innerHTML = '';
      });
  </script>
  <style>
    .tab-btn {
      background: #222;
      color: #eee;
      border: none;
      border-radius: 6px 6px 0 0;
      padding: 0.7em 2em;
      font-size: 1em;
      cursor: pointer;
      margin-bottom: -2px;
    }
    .tab-btn:focus {
      outline: 2px solid #888;
    }
  </style>
</body>
</html>
